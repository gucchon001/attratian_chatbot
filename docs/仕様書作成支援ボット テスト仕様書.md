# 仕様書作成支援ボット テスト仕様書

| バージョン | ステータス | 作成日 | 参照ドキュメント |
| :--- | :--- | :--- | :--- |
| **v1.2** | **最新版** | 2025/01/17 | 要件定義書 v3.5, 基本設計書 v1.5, 画面設計書 v1.6, JSON階層フィルター機能仕様書 v1.0 |

**v1.2更新内容:**
- ST-05: 削除ページフィルターシナリオテスト追加
- ST-06: 階層フィルターシナリオテスト追加 
- ST-07, ST-08: Jira拡張フィルター・日付範囲フィルターテスト追加
- NFT-04: 階層フィルターパフォーマンステスト追加
- NFT-05, NFT-06: Jira複雑フィルター・カスタムフィールドパフォーマンステスト追加
- JSON階層フィルター機能とJiraフィルター強化の詳細テスト仕様への参照追加

---

## 1. 概要
本ドキュメントは、「仕様書作成支援ボット」MVPの品質を保証し、要件定義を満たしていることを検証するためのテスト計画とテストケースを定義するものである。

## 2. テスト範囲
本テスト仕様書の範囲は、**要件定義書 v3.3**で定義された以下のMVP機能とする。

* LangChainエージェントの基本動作（思考、ツール選択）
* 会話メモリ機能（文脈理解）
* Jira検索ツール（**フィルター対応**）
* Confluence検索ツール（**フィルター対応**）
* StreamlitによるチャットUIとインタラクション
* **高度な絞り込みフィルター機能（サイドバー）**
* **フィルター選択肢のキャッシュ機能（自動・手動更新）**

## 3. テスト観点
以下の観点からテストを実施する。

* **機能テスト:** 各機能が仕様通りに正しく動作すること。
* **シナリオテスト:** 実際の利用者を想定した一連の操作（ユースケース）が問題なく完了すること。
* **非機能テスト:** パフォーマンス（応答速度）やエラーハンドリング、キャッシュ機能が要件を満たしていること。

## 4. テスト環境
* **実行環境:** ローカル開発環境（Windows/macOS）
* **ブラウザ:** Google Chrome 最新版
* **データ:** 開発用のJira/Confluenceプロジェクトおよびテストデータ

---

## 5. テストケース

### 5.1. 単体テスト (Tool & Moduleレベル)

| ID | テスト対象 | テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| UT-01 | `search_jira_tool` | 正常系：フィルター適用 | `query="改修"`, `statuses=["進行中"]`で関数実行 | 「進行中」ステータスの「改修」に関するチケット情報のみが返却される。 |
| UT-02 | `manage_config_cache` | 正常系：初回キャッシュ作成 | `config_cache.json`が存在しない状態で関数実行 | APIが呼び出され、`config_cache.json`ファイルが作成される。 |
| UT-03 | `manage_config_cache` | 正常系：キャッシュ読み込み | 有効期限内の`config_cache.json`が存在する状態で関数実行 | APIは呼び出されず、ローカルのJSONファイルからデータが読み込まれる。 |
| UT-04 | `manage_config_cache` | 正常系：強制更新 | `force_update=True`で関数実行 | キャッシュの有効期限に関わらず、APIが呼び出され、キャッシュが更新される。 |

### 5.2. 結合テスト (Agentレベル)

| ID | テスト対象 | テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- | :--- | :--- |
| IT-01 | LangChain Agent | ツール選択（フィルターあり） | 「進行中のログイン関連チケットをJiraで探して」と入力 | Agentが思考プロセスで`search_jira_tool`を選択し、`query="ログイン"`と`statuses=["進行中"]`を引数として実行する。 |
| IT-02 | LangChain Agent | 会話メモリ機能 | 1. 「進行中のチケットを教えて」と入力。<br>2. 応答後、「その中で担当者が原口さんのものは？」と追加質問。 | Agentが直前の「進行中」という文脈を記憶し、担当者「原口」でさらに絞り込んだ結果を回答する。 |

### 5.3. システムテスト (シナリオテスト)

| ID | テストシナリオ | 操作手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| ST-01 | **基本検索シナリオ** | 1. アプリを起動。<br>2. サイドバーのフィルターはデフォルトのまま。<br>3. 「ログイン機能」と入力し送信。 | 1. 初期メッセージとデフォルトのフィルター値が表示される。<br>2. AIによる要約とJira/Confluenceへのリンクを含む応答が正常に表示される。 |
| ST-02 | **絞り込み検索シナリオ** | 1. サイドバーのJiraフィルターで、ステータスを「完了」のみにチェック。<br>2. 「UI改善」と入力し送信。 | 1. 応答メッセージに「Jiraステータス: `完了`」というフィルター条件が表示される。<br>2. 完了済みのチケットのみを対象とした検索結果が返ってくる。 |
| ST-03 | **フィルター選択肢の更新シナリオ** | 1. （事前にJira側で新しいステータスを追加しておく）<br>2. サイドバーの「選択肢を更新」ボタンをクリック。<br>3. Jiraフィルターのステータス選択肢を確認する。 | 1. 「選択肢を更新しました！」というメッセージが表示される。<br>2. ステータスの選択肢に、Jiraで新しく追加したステータスが表示される。 |
| ST-04 | **連続会話シナリオ** | 1. ST-02を実行。<br>2. 応答後、「ありがとう。じゃあ今度はConfluenceだけで仕様書を探して」と追加で質問。 | Agentが会話の流れを理解し、JiraではなくConfluenceのみを対象として検索を実行し、応答を返す。 |
| **ST-05** | **削除ページフィルターシナリオ** | **1. Confluenceフィルターを展開。<br>2. 「削除ページを含む」をOFFのまま検索実行。<br>3. 同チェックボックスをONにして再検索。** | **1. 【%%削除%%】【%%廃止%%】ページが除外された結果表示。<br>2. 削除ページも含む結果が表示（🗑️アイコン付き）。** |
| **ST-06** | **階層フィルターシナリオ** | **1. ページ階層フィルターで「■要件定義」フォルダを選択。<br>2. 「機能仕様について」と検索実行。** | **1. 選択フォルダ配下のページのみが検索対象となる。<br>2. 他フォルダのページは結果に含まれない。** |
| **ST-07** | **Jira拡張フィルターシナリオ** | **1. Jiraフィルターを展開し、「チケットタイプ」で「Bug」を選択。<br>2. 「カスタム担当」で特定値を選択。<br>3. 「ログイン」で検索実行。** | **1. Bug種別のチケットのみが検索対象となる。<br>2. 選択したカスタムフィールド値でさらに絞り込まれる。<br>3. 複合条件での正確な結果表示。** |
| **ST-08** | **Jira日付範囲フィルターシナリオ** | **1. Jira日付フィルターで「作成日（以降）」に過去30日を設定。<br>2. 「更新日（以前）」に今日を設定。<br>3. 「バグ修正」で検索実行。** | **1. 指定期間内に作成されたチケットのみ表示。<br>2. 指定日以前に更新されたチケットのみ表示。<br>3. 日付範囲の組み合わせ条件で正確な絞り込み。** |

### 5.4. 非機能テスト

| ID | テスト観点 | テスト項目 | 操作手順 | 期待される結果 |
| :--- | :--- | :--- | :--- |
| NFT-01 | **パフォーマンス** | 応答速度計測 | ST-01のシナリオを実行し、送信から応答表示までの時間を計測する。 | 応答時間が目標値（30秒、最大1分）以内であること。 |
| NFT-02 | **エラーハンドリング** | API認証エラー | `.env`ファイルのJira APIトークンを意図的に不正な値に変更してアプリを起動し、検索を実行する。 | 「Jiraへの接続に失敗しました」等のユーザーに分かりやすいエラーメッセージがチャット画面に表示される。開発者向けのGoogle Chat通知が送信される。 |
| NFT-03 | **キャッシュ** | キャッシュ有効性確認 | 1. アプリを起動し、検索を実行。<br>2. アプリを再起動し、再度同じ検索を実行。 | 1. 1回目の実行ログに「キャッシュを更新します...」と表示される。<br>2. 2回目の実行ログに「キャッシュが有効なため...」と表示され、API通信が発生しない。 |
| **NFT-04** | **階層フィルターパフォーマンス** | **階層フィルター応答速度** | **階層フィルターのチェックボックス選択・解除を10回連続実行し応答時間を計測。** | **各操作が0.1秒以下で完了し、UIが即座に反応する。** |
| **NFT-05** | **Jira複雑フィルターパフォーマンス** | **12パラメータ同時指定** | **Jiraフィルター全12項目を同時に指定し、複雑なJQLクエリでの検索応答時間を計測。** | **10条件以上の複合検索でも2秒以内で結果表示される。** |
| **NFT-06** | **Jiraカスタムフィールド性能** | **CTJ専用フィールド検索** | **customfield_10277, 10291を含む検索を20回連続実行し、応答時間の安定性を検証。** | **専用フィールド検索の平均応答時間が1秒以下で安定する。** |

**📄 詳細テスト:** 
- **Confluence**: [JSON階層フィルター機能_仕様書.md](./JSON階層フィルター機能_仕様書.md#実装計画) のPhase 6を参照
- **Jira**: [画面設計書 v1.6](./仕様書作成支援ボット%20画面設計書.md#2-jiraフィルター強化版-v16追加) のパフォーマンス指標を参照